2025-03-05 15:02:19,787 - INFO - =============== Configurations ===============
2025-03-05 15:02:19,789 - INFO - DATA_MODE: offline
2025-03-05 15:02:19,790 - INFO - START_DATE: 2000-01-01
2025-03-05 15:02:19,791 - INFO - END_DATE: 2024-12-31
2025-03-05 15:02:19,793 - INFO - TICKERS: ['SPY', 'QQQ', 'IAU', 'IEF']
2025-03-05 15:02:19,794 - INFO - ASSET_ALLOCATION: {'QQQ': 0.5, 'IAU': 0.3, 'IEF': 0.2}
2025-03-05 15:02:19,795 - INFO - AGGRESSIVE_ALLOCATION: {'QQQ': 0.8, 'IAU': 0.2, 'IEF': 0}
2025-03-05 15:02:19,796 - INFO - MODERATE_ALLOCATION: {'QQQ': 0.7, 'IAU': 0.2, 'IEF': 0.1}
2025-03-05 15:02:19,798 - INFO - DEFENSIVE_ALLOCATION: {'QQQ': 0, 'IAU': 0.5, 'IEF': 0.5}
2025-03-05 15:02:19,799 - INFO - MID_DEFENSIVE_ALLOCATION: {'QQQ': 0.3, 'IAU': 0.5, 'IEF': 0.2}
2025-03-05 15:02:19,800 - INFO - TOUCHSTONE: SPY
2025-03-05 15:02:19,801 - INFO - MA_PERIODS: [21, 50, 150, 200]
2025-03-05 15:02:19,802 - INFO - WMA_PERIODS: [10, 30]
2025-03-05 15:02:19,803 - INFO - MA_TYPE: weekly
2025-03-05 15:02:19,804 - INFO - INITIAL_CASH: 100000.0
2025-03-05 15:02:19,805 - INFO - COMMISSION: 0.001
2025-03-05 15:02:19,806 - INFO - CASH_BUFFER_PERCENT: 1.0
2025-03-05 15:02:19,807 - INFO - PROCESS_SELL_FIRST: True
2025-03-05 15:02:19,808 - INFO - RISK_FREE_RATE: 0.01
2025-03-05 15:02:19,809 - INFO - FRACTIONAL_SHARES: False
2025-03-05 15:02:19,810 - INFO - USE_MARKET_REGIME: True
2025-03-05 15:02:19,811 - INFO - LOG_LEVEL: INFO
2025-03-05 15:02:19,812 - INFO - ===============================================
2025-03-05 15:02:19,813 - INFO - Starting backtest...
2025-03-05 15:02:19,814 - INFO - Loading data feeds...
2025-03-05 15:02:19,815 - INFO - Loading data for SPY...
2025-03-05 15:02:19,818 - INFO - Downloading data for SPY from 2000-01-01 to 2024-12-31.
2025-03-05 15:03:20,712 - WARNING - Attempt 1/3 failed for SPY: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C56E871C90>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))
2025-03-05 15:03:20,715 - INFO - Retry 1/3 for SPY after 2s.
2025-03-05 15:03:40,497 - WARNING - Attempt 2/3 failed for SPY: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FEA10>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))
2025-03-05 15:03:40,497 - INFO - Retry 2/3 for SPY after 4s.
2025-03-05 15:03:44,511 - WARNING - Attempt 3/3 failed for SPY: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))
2025-03-05 15:03:44,511 - ERROR - Max retries exceeded for SPY.
2025-03-05 15:03:44,512 - ERROR - Failed to load data for SPY: Cannot retrieve data for SPY: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))
2025-03-05 15:03:44,512 - ERROR - Error loading data: Touchstone ticker data retrieval failed for SPY: Cannot retrieve data for SPY: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))
2025-03-05 15:03:44,528 - ERROR - Traceback (most recent call last):
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\connection.py", line 174, in _new_conn
    conn = connection.create_connection(
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\util\connection.py", line 72, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
  File "C:\Users\james\anaconda3\envs\dnn\lib\socket.py", line 955, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
socket.gaierror: [Errno 11001] getaddrinfo failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\connectionpool.py", line 386, in _make_request
    self._validate_conn(conn)
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\connectionpool.py", line 1042, in _validate_conn
    conn.connect()
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\connection.py", line 358, in connect
    self.sock = conn = self._new_conn()
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    retries = retries.increment(
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\urllib3\util\retry.py", line 592, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\james\Projects\backtrader\data_utils.py", line 91, in download_and_preprocess
    df = fdr.DataReader(ticker, start_date, end_date)
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\FinanceDataReader\data.py", line 92, in DataReader
    return YahooDailyReader(codes, start, end).read()
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\FinanceDataReader\yahoo\data.py", line 61, in read
    return _yahoo_data_reader(self.symbol, self.exchange, self.start, self.end)
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\FinanceDataReader\yahoo\data.py", line 37, in _yahoo_data_reader
    r = requests.get(url, headers={'user-agent': 'Mozilla/5.0 AppleWebKit/537.36'})
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\james\anaconda3\envs\dnn\lib\site-packages\requests\adapters.py", line 700, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\james\Projects\backtrader\data_utils.py", line 179, in prepare_backtrader_data
    df = download_and_preprocess(ticker=ticker, start_date=start_date, end_date=end_date,
  File "C:\Users\james\Projects\backtrader\data_utils.py", line 138, in download_and_preprocess
    raise ConnectionError(f"Cannot retrieve data for {ticker}: {e}")
ConnectionError: Cannot retrieve data for SPY: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\james\Projects\backtrader\backtest.py", line 376, in run_backtest
    data_feeds = prepare_backtrader_data(
  File "C:\Users\james\Projects\backtrader\data_utils.py", line 205, in prepare_backtrader_data
    raise ValueError(f"Touchstone ticker data retrieval failed for {touchstone}: {e}")
ValueError: Touchstone ticker data retrieval failed for SPY: Cannot retrieve data for SPY: HTTPSConnectionPool(host='query2.finance.yahoo.com', port=443): Max retries exceeded with url: /v8/finance/chart/SPY?period1=946652400&period2=1735570800&interval=1d&includeAdjustedClose=true (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x000001C5730FE6E0>: Failed to establish a new connection: [Errno 11001] getaddrinfo failed'))

